{% extends "base.html" %}

{% block page_title %}Пользователи и рефералы{% endblock %}

{% block content %}

<div class="table-container">
  <div class="table-header">
    <h2>Пользователи</h2>
    <div class="stats-row">
      <div class="stat-item"><span class="stat-label">Всего:</span><span class="stat-value">{{ total }}</span></div>
    </div>
  </div>

  <div class="filter-row">
    <form method="get" action="/users" style="display:flex; gap:8px; align-items:center;">
      <input type="text" name="q" placeholder="Поиск по User ID" value="{{ q }}" />
      <button class="btn" type="submit">Искать</button>
    </form>
  </div>

  <div style="overflow-x: auto;">
    <table class="unified-table">
      <thead>
        <tr>
          <th style="width: 200px;">User ID</th>
          <th style="width: 160px;">Рефералов</th>
          <th style="width: 120px;">Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.user_id }}</td>
          <td>{{ user.referral_count }}</td>
          <td>
            <a href="/users/{{ user.user_id }}" class="btn btn-primary">Подробнее</a>
          </td>
        </tr>
        {% endfor %}
        {% if not users %}
        <tr><td colspan="3" style="text-align:center; color:#6b7280;">Нет данных</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <div class="pagination">
    {% set pages = (total // limit) + (1 if (total % limit) else 0) %}
    {% if page > 1 %}
      <a class="btn" href="/users?page={{ page-1 }}&limit={{ limit }}&q={{ q }}">←</a>
    {% endif %}
    {% for p in range(1, pages+1) %}
      {% if p == 1 or p == pages or (p >= page-2 and p <= page+2) %}
        <a class="btn {% if p==page %}active{% endif %}" href="/users?page={{ p }}&limit={{ limit }}&q={{ q }}">{{ p }}</a>
      {% elif p == page-3 or p == page+3 %}
        <span style="padding:4px 8px; color:#6b7280;">…</span>
      {% endif %}
    {% endfor %}
    {% if page < pages %}
      <a class="btn" href="/users?page={{ page+1 }}&limit={{ limit }}&q={{ q }}">→</a>
    {% endif %}
  </div>
</div>
{% endblock %}