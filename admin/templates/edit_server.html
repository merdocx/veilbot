{% extends "base.html" %}

{% block page_title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä{% endblock %}

{% block content %}
<div class="form-container">
    <div class="card-header">
        <h2 class="card-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä</h2>
    </div>
    
    <!-- Server Type Display -->
    <div class="server-type-display">
        <div class="server-type-badge">
            {% if server.protocol == 'v2ray' %}
                <span class="server-type-icon">üõ°Ô∏è</span>
                <span class="server-type-text">V2Ray VLESS</span>
            {% else %}
                <span class="server-type-icon">üîí</span>
                <span class="server-type-text">Outline VPN</span>
            {% endif %}
        </div>
        <div class="server-type-description">
            {% if server.protocol == 'v2ray' %}
                –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª —Å –æ–±—Ñ—É—Å–∫–∞—Ü–∏–µ–π —Ç—Ä–∞—Ñ–∏–∫–∞
            {% else %}
                –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π VPN –ø—Ä–æ—Ç–æ–∫–æ–ª —Å –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é
            {% endif %}
        </div>
    </div>
    
    {% if error_message %}
    <div class="alert alert-error" style="margin-bottom: 1rem; padding: 0.75rem 1rem; background: #fee; border: 1px solid #fcc; border-radius: 6px; color: #c00;">
        {{ error_message }}
    </div>
    {% endif %}
    <form method="post" action="/servers/edit/{{ server.id }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <input type="hidden" name="protocol" value="{{ server.protocol or 'outline' }}">
        
        <div class="form-grid">
            <!-- Common Fields -->
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ *</label>
                <input type="text" name="name" class="form-input" required 
                       value="{{ server.name }}" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
            </div>
            
            <div class="form-group">
                <label class="form-label">API URL *</label>
                <input type="url" name="api_url" class="form-input" required 
                       value="{{ server.api_url }}" placeholder="https://server.com:port/api">
            </div>
            
            <div class="form-group">
                <label class="form-label">–ú–∞–∫—Å–∏–º—É–º –∫–ª—é—á–µ–π *</label>
                <input type="number" name="max_keys" class="form-input" required 
                       value="{{ server.max_keys }}" placeholder="100" min="1">
            </div>
            
            <div class="form-group">
                <label class="form-label">–°—Ç—Ä–∞–Ω–∞</label>
                <input type="text" name="country" class="form-input" 
                       value="{{ server.country }}" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É">
            </div>
            
            <!-- Outline-specific fields -->
            <div class="form-group outline-fields {% if server.protocol != 'outline' %}hidden{% endif %}">
                <label class="form-label">SHA256 —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ *</label>
                <input type="text" name="cert_sha256" class="form-input" 
                       value="{{ server.cert_sha256 }}" placeholder="XX:XX:XX:XX:XX:XX:XX:XX">
            </div>
            
            <!-- V2Ray-specific fields -->
            <div class="form-group v2ray-fields {% if server.protocol != 'v2ray' %}hidden{% endif %}">
                <label class="form-label">–î–æ–º–µ–Ω</label>
                <input type="text" name="domain" class="form-input" 
                       value="{{ server.domain }}" placeholder="example.com">
                <small class="form-help-text">–ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π VLESS URL.</small>
            </div>
            
            <div class="form-group v2ray-fields {% if server.protocol != 'v2ray' %}hidden{% endif %}">
                <label class="form-label">API –ö–ª—é—á *</label>
                <input type="text" name="api_key" class="form-input" 
                       value="{{ server.api_key }}" placeholder="veil-bird-secret-api-key-2024">
            </div>
            
            <div class="form-group v2ray-fields {% if server.protocol != 'v2ray' %}hidden{% endif %}">
                <label class="form-label">V2Ray –ü—É—Ç—å</label>
                <input type="text" name="v2ray_path" class="form-input" 
                       value="{{ server.v2ray_path or '/v2ray' }}" placeholder="/v2ray">
            </div>
            
            <div class="form-group">
                <label class="form-checkbox">
                    <input type="checkbox" name="active" {% if server.active %}checked{% endif %}>
                    <span>–ê–∫—Ç–∏–≤–µ–Ω</span>
                </label>
            </div>
            
            <div class="form-group">
                <label class="form-label">–£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞ *</label>
                <select name="access_level" class="form-input" required>
                    <option value="all" {% if server.access_level == 'all' or not server.access_level %}selected{% endif %}>–î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤—Å–µ—Ö</option>
                    <option value="paid" {% if server.access_level == 'paid' %}selected{% endif %}>–î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –∏ VIP</option>
                    <option value="vip" {% if server.access_level == 'vip' %}selected{% endif %}>–î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è VIP</option>
                </select>
                <small class="form-help-text">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫—Ç–æ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–º—É —Å–µ—Ä–≤–µ—Ä—É –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª—é—á–∞.</small>
            </div>
        </div>
        
        <div class="card-actions">
            <a href="/servers" class="btn btn-secondary">
                <span class="material-icons">arrow_back</span>
                –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
            </a>
            <button type="submit" class="btn btn-primary">
                <span class="material-icons">save</span>
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
            </button>
        </div>
    </form>
</div>

<style>
.server-type-display {
    text-align: center;
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.server-type-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.server-type-icon {
    font-size: 1.5rem;
}

.server-type-text {
    font-size: 1.1rem;
    font-weight: 600;
    color: #333;
}

.server-type-description {
    font-size: 0.9rem;
    color: #666;
    font-style: italic;
}

.form-grid {
    margin-top: 1rem;
}
</style>
{% endblock %}

{% block extra_scripts %}
    {{ super() }}
    <script type="module" src="/static/js/editServer.js"></script>
{% endblock %} 