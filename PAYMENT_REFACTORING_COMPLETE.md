# ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –º–æ–¥—É–ª—è

## üéØ –û–±–∑–æ—Ä
–£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ legacy adapter –∏ —É–¥–∞–ª–µ–Ω–∏–µ fallback –ª–æ–≥–∏–∫–∏. –°—Ç–∞—Ä—ã–π –ø–ª–∞—Ç–µ–∂–Ω—ã–π –º–æ–¥—É–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω.

## üìÖ –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- **–î–∞—Ç–∞**: 7 –∞–≤–≥—É—Å—Ç–∞ 2025
- **–í—Ä–µ–º—è**: 21:45 MSK
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ

## üîÑ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### ‚úÖ 1. –î–æ—Ä–∞–±–æ—Ç–∫–∞ Legacy Adapter
- **–§–∞–π–ª**: `payments/adapters/legacy_adapter.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞–µ–≤ –±–µ–∑ email
- **–ë—ã–ª–æ**: –í–æ–∑–≤—Ä–∞—Ç `(None, None)` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ email
- **–°—Ç–∞–ª–æ**: –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ email `user_{user_id}@veilbot.com`

### ‚úÖ 2. –£–¥–∞–ª–µ–Ω–∏–µ Fallback –ª–æ–≥–∏–∫–∏
- **–§–∞–π–ª**: `bot.py`
- **–£–¥–∞–ª–µ–Ω–æ**: –ò–º–ø–æ—Ä—Ç `from payment import create_payment, check_payment`
- **–£–¥–∞–ª–µ–Ω–æ**: Fallback –±–ª–æ–∫–∏ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö
- **–£–¥–∞–ª–µ–Ω–æ**: –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `handle_paid_tariff`, `create_payment_with_email`, `wait_for_payment`

### ‚úÖ 3. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –º–æ–¥—É–ª—è
- **–§–∞–π–ª**: `payment.py` - **–ü–û–õ–ù–û–°–¢–¨–Æ –£–î–ê–õ–ï–ù**
- **–°—Ç–∞—Ç—É—Å**: –°—Ç–∞—Ä—ã–π –ø–ª–∞—Ç–µ–∂–Ω—ã–π –º–æ–¥—É–ª—å –±–æ–ª—å—à–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥

### ‚úÖ 4. –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
- **–§—É–Ω–∫—Ü–∏—è**: `create_payment_with_email_and_protocol()`
  - –£–±—Ä–∞–Ω–∞ fallback –ª–æ–≥–∏–∫–∞
  - –û—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂–Ω—ã–π –º–æ–¥—É–ª—å
  - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- **–§—É–Ω–∫—Ü–∏—è**: `wait_for_payment_with_protocol()`
  - –£–±—Ä–∞–Ω–∞ fallback –ª–æ–≥–∏–∫–∞
  - –û—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂–Ω—ã–π –º–æ–¥—É–ª—å
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### ‚úÖ 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
- **–§–∞–π–ª**: `test_bot.py`
  - –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –º–æ–¥—É–ª—è
  - –£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `payment.py`
  - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è

- **–§–∞–π–ª**: `run_tests.py`
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ payments –º–æ–¥—É–ª—è

### ‚úÖ 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CI/CD
- **–§–∞–π–ª**: `.github/workflows/ci.yml`
  - –£–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `payment.py`
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ payments –º–æ–¥—É–ª—è
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç—ã –º–æ–¥—É–ª—è
```
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
   Legacy adapter: ‚úÖ (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–∏ –±–µ–∑ email)
   –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π: ‚úÖ
   –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: ‚úÖ
```

### –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
```
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
   –ü–ª–∞—Ç–µ–∂–Ω—ã–π –º–æ–¥—É–ª—å: ‚úÖ
   –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º: ‚úÖ
   –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ë–î: ‚úÖ
```

### –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```
=== –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê ===
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤: ‚úÖ –ë–æ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ legacy adapter: ‚úÖ Legacy adapter –¥–æ—Å—Ç—É–ø–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å—Ç–∞—Ä–æ–≥–æ –º–æ–¥—É–ª—è: ‚úÖ –°—Ç–∞—Ä—ã–π –º–æ–¥—É–ª—å –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤: ‚úÖ –í—Å–µ 12 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã/—Ñ—É–Ω–∫—Ü–∏–∏
- ‚ùå **–§–∞–π–ª**: `payment.py` - –ü–û–õ–ù–û–°–¢–¨–Æ –£–î–ê–õ–ï–ù
- ‚ùå –ò–º–ø–æ—Ä—Ç `from payment import create_payment, check_payment`
- ‚ùå –§—É–Ω–∫—Ü–∏—è `handle_paid_tariff()`
- ‚ùå –§—É–Ω–∫—Ü–∏—è `create_payment_with_email()`
- ‚ùå –§—É–Ω–∫—Ü–∏—è `wait_for_payment()`
- ‚ùå Fallback –ª–æ–≥–∏–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ `bot.py` - —É–±—Ä–∞–Ω–∞ fallback –ª–æ–≥–∏–∫–∞
- ‚úÖ `payments/adapters/legacy_adapter.py` - –¥–æ—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ email
- ‚úÖ `test_bot.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã
- ‚úÖ `run_tests.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ `.github/workflows/ci.yml` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ CI/CD

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- **–£–ø—Ä–æ—â–µ–Ω–∏–µ**: –£–±—Ä–∞–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è –ª–æ–≥–∏–∫–∞
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ï–¥–∏–Ω—ã–π –ø—É—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –ú–µ–Ω—å—à–µ –∫–æ–¥–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ù–µ—Ç fallback –ø—Ä–æ–≤–µ—Ä–æ–∫
- **–ß–∏—Å—Ç–æ—Ç–∞**: –°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ö–æ–¥
- **–£–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫**: ~200 (–≤–∫–ª—é—á–∞—è –≤–µ—Å—å —Ñ–∞–π–ª payment.py)
- **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫**: ~50
- **–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫**: ~20
- **–£–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤**: 1 (`payment.py`)

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ**: 100% —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **–£–ª—É—á—à–µ–Ω–æ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞–µ–≤ –±–µ–∑ email
- **–£–ø—Ä–æ—â–µ–Ω–æ**: –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- **–û—á–∏—â–µ–Ω–æ**: –£–¥–∞–ª–µ–Ω –≤–µ—Å—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —É–ª—É—á—à–µ–Ω–∞
- ‚úÖ –ù–µ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ
- **Legacy adapter** –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
- **Fallback –ª–æ–≥–∏–∫–∞** —É–¥–∞–ª–µ–Ω–∞
- **–°—Ç–∞—Ä—ã–π –º–æ–¥—É–ª—å** –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
- **–¢–µ—Å—Ç—ã** –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- **CI/CD** –æ–±–Ω–æ–≤–ª–µ–Ω

### üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (1-2 –¥–Ω—è)
2. **–û—á–∏—Å—Ç–∫–∞** –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ** README
4. **–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ—Ç—á–µ—Ç–∞ –æ –º–∏–≥—Ä–∞—Ü–∏–∏

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–î–æ—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –º–æ–¥—É–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!**

- ‚úÖ **Legacy adapter** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Å–ª—É—á–∞–∏
- ‚úÖ **Fallback –ª–æ–≥–∏–∫–∞** –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞
- ‚úÖ **–°—Ç–∞—Ä—ã–π –º–æ–¥—É–ª—å** –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
- ‚úÖ **–í—Å–µ —Ç–µ—Å—Ç—ã** –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç** –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥

–ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å. –°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω, —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–∏—Å—Ç–µ–º—ã.
