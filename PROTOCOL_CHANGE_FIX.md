# Исправление ошибки в функции смены протокола

## Проблема
В функции `change_protocol_for_key()` для Outline VPN была найдена критическая ошибка при удалении старого ключа.

## Найденная ошибка

**Файл:** `bot.py`, строка 1472
**Проблема:** Использовался URL нового сервера вместо старого для удаления ключа

**Было:**
```python
cursor.execute("SELECT cert_sha256 FROM servers WHERE id = ?", (old_server_id,))
old_cert_sha256 = cursor.fetchone()
if old_cert_sha256:
    try:
        await asyncio.get_event_loop().run_in_executor(None, delete_key, api_url, old_cert_sha256[0], key_data['id'])
    except Exception as e:
        print(f"[WARNING] Не удалось удалить старый Outline ключ (возможно уже удален): {e}")
```

**Стало:**
```python
cursor.execute("SELECT api_url, cert_sha256 FROM servers WHERE id = ?", (old_server_id,))
old_server_data = cursor.fetchone()
if old_server_data:
    old_api_url, old_cert_sha256 = old_server_data
    try:
        await asyncio.get_event_loop().run_in_executor(None, delete_key, old_api_url, old_cert_sha256, key_data['key_id'])
    except Exception as e:
        print(f"[WARNING] Не удалось удалить старый Outline ключ (возможно уже удален): {e}")
```

## Исправления
1. ✅ Получаем данные старого сервера (api_url и cert_sha256)
2. ✅ Используем правильный URL старого сервера для удаления ключа
3. ✅ Исправлен параметр `key_data['key_id']` вместо `key_data['id']`

## Проверка соответствия требованиям

### ✅ Требование 1: Выбор ключа при нескольких ключах
- **Логика:** Корректно работает
- **Меню:** Показывается список всех ключей
- **Выбор:** Пользователь может выбрать конкретный ключ

### ✅ Требование 2: Удаление старого ключа
- **Из базы данных:** ✅ Работает корректно
- **С VPN сервера:** ✅ Теперь использует правильный URL старого сервера

### ✅ Требование 3: Создание нового ключа
- **Новый протокол:** ✅ Создается на противоположном протоколе
- **Та же страна:** ✅ Сохраняется та же страна
- **Новый сервер:** ✅ Выбирается сервер с новым протоколом

## Результат
Теперь функция "Сменить приложение" работает корректно для обоих протоколов:

1. **Outline → V2Ray:** Старый Outline ключ удаляется с правильного сервера, новый V2Ray ключ создается
2. **V2Ray → Outline:** Старый V2Ray ключ удаляется с правильного сервера, новый Outline ключ создается

## Статус
- ✅ Исправления применены
- ✅ Сервис перезапущен
- ✅ Бот работает корректно
- ✅ Все требования выполнены 