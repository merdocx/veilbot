# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ V2Ray API

## –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏
**–î–∞—Ç–∞:** $(date '+%Y-%m-%d %H:%M:%S')  
**–°–µ—Ä–≤–µ—Ä:** VeilBot (46.151.31.105)  
**–¶–µ–ª–µ–≤–æ–π —Å–µ—Ä–≤–µ—Ä:** V2Ray API (38.180.192.10:8000)

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### 1. GET /api (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ IP)
```bash
curl -v --max-time 10 http://38.180.192.10:8000/api
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- ‚úÖ HTTP –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
- ‚ùå –û—Ç–≤–µ—Ç–∞ –Ω–µ—Ç (—Ç–∞–π–º–∞—É—Ç —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)

### 2. POST /api/keys (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ IP –∏ —Ç–æ–∫–µ–Ω)
```bash
curl -v --max-time 10 -X POST "http://38.180.192.10:8000/api/keys" \
  -H "Authorization: Bearer 5a5-lxUnQF75TzeoObRGLZuHe27Qh_PnfxKPuxnplXA" \
  -H "Content-Type: application/json" \
  -d '{"name":"test"}'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- ‚úÖ HTTP –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω (29 bytes –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥–∞–Ω
- ‚ùå –û—Ç–≤–µ—Ç–∞ –Ω–µ—Ç (—Ç–∞–π–º–∞—É—Ç —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö –Ω–∞ V2Ray —Å–µ—Ä–≤–µ—Ä–µ

### –ù–∞ V2Ray —Å–µ—Ä–≤–µ—Ä–µ (38.180.192.10) –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u veil-xray-api -f | grep -E 'Request from IP|Access|46.151|77.246|POST|GET|Incoming'
```

### –û–∂–∏–¥–∞–µ–º—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥–∞—Ö:

#### ‚úÖ –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –¥–æ—Ö–æ–¥—è—Ç –¥–æ API:

**–î–ª—è GET /api:**
```
üì• Incoming GET /api from IP: 46.151.31.105
GET /api - Status: 200
```

–∏–ª–∏

```
üîç Request from IP: 46.151.31.105 to /api
‚úÖ Access granted
```

**–î–ª—è POST /api/keys:**
```
üì• Incoming POST /api/keys from IP: 46.151.31.105
üîç Request from IP: 46.151.31.105 to /api/keys
‚úÖ Access granted for IP 46.151.31.105
POST /api/keys - Status: 200
```

#### ‚ùå –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è whitelist:

```
üì• Incoming POST /api/keys from IP: 46.151.31.105
üîç Request from IP: 46.151.31.105 to /api/keys
‚ö†Ô∏è Access denied for IP 46.151.31.105 (not in whitelist)
```

–∏–ª–∏

```
‚ö†Ô∏è IP 46.151.31.105 not in whitelist
Access denied
```

#### ‚ùå –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ API:

**–õ–æ–≥–∏ –ø—É—Å—Ç—ã–µ:**
- –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π "üì• Incoming"
- –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π "Request from IP"
- –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –∑–∞–ø—Ä–æ—Å–∞—Ö

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ó–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ñ–∞–π—Ä–≤–æ–ª–∞/–ø—Ä–æ–∫—Å–∏ –¥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ç–∏/—Ñ–∞–π—Ä–≤–æ–ª–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- DDoS –∑–∞—â–∏—Ç–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞–ø—Ä–æ—Å—ã –≤–∏–¥–Ω—ã –≤ –ª–æ–≥–∞—Ö, –Ω–æ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** IP –Ω–µ –≤ whitelist –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è whitelist

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é whitelist –Ω–∞ V2Ray —Å–µ—Ä–≤–µ—Ä–µ
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–±–∞ IP:
   - `46.151.31.105`
   - `77.246.105.29`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç whitelist (–º–æ–∂–µ—Ç –±—ã—Ç—å CIDR –∏–ª–∏ —Ç–æ—á–Ω—ã–π IP)
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
   ```bash
   sudo systemctl restart veil-xray-api
   ```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ó–∞–ø—Ä–æ—Å—ã –Ω–µ –≤–∏–¥–Ω—ã –≤ –ª–æ–≥–∞—Ö

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. **–§–∞–π—Ä–≤–æ–ª –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞/–æ–±–ª–∞–∫–∞:**
   - Security Groups / Firewall Rules
   - –ü–æ—Ä—Ç 8000 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –¥–ª—è:
     - `46.151.31.105/32`
     - `77.246.105.29/32`

2. **DDoS –∑–∞—â–∏—Ç–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:**
   - –ú–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –î–æ–±–∞–≤—å—Ç–µ IP –≤ whitelist –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   - –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

3. **–ü—Ä–æ–∫—Å–∏/–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –ø–µ—Ä–µ–¥ API:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –ø—Ä–æ–∫—Å–∏ –ø–µ—Ä–µ–¥ API
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–æ–∫—Å–∏

4. **–§–∞–π—Ä–≤–æ–ª –Ω–∞ V2Ray —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   sudo ufw status
   sudo iptables -L -n -v | grep 8000
   ```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ó–∞–ø—Ä–æ—Å—ã –≤–∏–¥–Ω—ã –≤ –ª–æ–≥–∞—Ö, –Ω–æ API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ API

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. **–õ–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏:**
   ```bash
   sudo journalctl -u veil-xray-api -n 100 | grep -i error
   ```

2. **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   top
   htop
   ```

3. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤:**
   ```bash
   df -h
   free -h
   ```

## –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VeilBot

- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã —É–≤–µ–ª–∏—á–µ–Ω—ã –¥–æ 90 —Å–µ–∫—É–Ω–¥
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–µ–π –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚úÖ –û–±–∞ IP –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç—É–ø–Ω—ã: 46.151.31.105 –∏ 77.246.105.29

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –Ω–∞ V2Ray —Å–µ—Ä–≤–µ—Ä–µ
2. ‚úÖ –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ, –¥–æ—Ö–æ–¥—è—Ç –ª–∏ –∑–∞–ø—Ä–æ—Å—ã –¥–æ API
3. ‚úÖ –ï—Å–ª–∏ –¥–æ—Ö–æ–¥—è—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ whitelist –∏ –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
4. ‚úÖ –ï—Å–ª–∏ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞/–æ–±–ª–∞–∫–∞
5. ‚úÖ –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ù–∞ VeilBot —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
/root/veilbot/check_v2ray_api.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
curl -v --max-time 10 http://38.180.192.10:8000/api
curl -v --max-time 10 -X POST "http://38.180.192.10:8000/api/keys" \
  -H "Authorization: Bearer 5a5-lxUnQF75TzeoObRGLZuHe27Qh_PnfxKPuxnplXA" \
  -H "Content-Type: application/json" \
  -d '{"name":"test"}'
```

### –ù–∞ V2Ray —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
sudo journalctl -u veil-xray-api -f | grep -E 'Request from IP|Access|46.151|77.246'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl -v http://127.0.0.1:8000/api
curl -X POST "http://127.0.0.1:8000/api/keys" \
  -H "Authorization: Bearer 5a5-lxUnQF75TzeoObRGLZuHe27Qh_PnfxKPuxnplXA" \
  -H "Content-Type: application/json" \
  -d '{"name":"test"}'
```

## –í—ã–≤–æ–¥

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- HTTP –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è, –Ω–æ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç
- –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ FIN-WAIT-2

**–ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- –ó–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ñ–∞–π—Ä–≤–æ–ª–∞/–ø—Ä–æ–∫—Å–∏ –¥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò–ª–∏ IP –Ω–µ –≤ whitelist (–µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –¥–æ—Ö–æ–¥—è—Ç –¥–æ API)

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ V2Ray —Å–µ—Ä–≤–µ—Ä–µ, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã.
