# –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ V2Ray –∫–ª—é—á–µ–π –æ—Ç –ª–∏—à–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "–°–º–µ–Ω–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" –æ—Ç–æ–±—Ä–∞–∂–∞–ª–æ—Å—å –º–Ω–æ–≥–æ –ª–∏—à–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: –∏–º—è, uuid, qr-–∫–æ–¥ –¥–∞–Ω–Ω—ã–µ. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–∑-–∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ V2Ray –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö –∫–æ–¥–∞.

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ V2Ray
–í –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Å—Ç–∞—Ä—ã–π WebSocket —Ñ–æ—Ä–º–∞—Ç –≤–º–µ—Å—Ç–æ –Ω–æ–≤–æ–≥–æ Reality –ø—Ä–æ—Ç–æ–∫–æ–ª–∞:

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞:**
- –°—Ç—Ä–æ–∫–∞ 618: `handle_free_tariff_with_protocol` - –ø—Ä–æ–¥–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–ª—é—á–∞
- –°—Ç—Ä–æ–∫–∞ 665: `create_new_key_flow_with_protocol` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞
- –°—Ç—Ä–æ–∫–∞ 601: `handle_free_tariff_with_protocol` - –ø—Ä–æ–¥–ª–µ–Ω–∏–µ Outline –∫–ª—é—á–∞

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Å—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è `format_key_message_with_protocol` –≤–º–µ—Å—Ç–æ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π `format_key_message_unified`.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ V2Ray

**–ë—ã–ª–æ (—Å—Ç–∞—Ä—ã–π WebSocket —Ñ–æ—Ä–º–∞—Ç):**
```python
config = f"vless://{v2ray_uuid}@{domain}:443?path={path}&security=tls&type=ws#VeilBot-V2Ray"
```

**–°—Ç–∞–ª–æ (–Ω–æ–≤—ã–π Reality —Ñ–æ—Ä–º–∞—Ç):**
```python
config = f"vless://{v2ray_uuid}@{domain}:443?encryption=none&security=reality&sni=www.microsoft.com&fp=chrome&pbk=TJcEEU2FS6nX_mBo-qXiuq9xBaP1nAcVia1MlYyUHWQ&sid=827d3b463ef6638f&spx=/&type=tcp&flow=#{email or 'VeilBot-V2Ray'}"
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ email –≤ get_user_config

**–ë—ã–ª–æ:**
```python
config = await protocol_client.get_user_config(user_data['uuid'], {
    'domain': server[4],
    'port': 443,
    'path': server[6] or '/v2ray'
})
```

**–°—Ç–∞–ª–æ:**
```python
config = await protocol_client.get_user_config(user_data['uuid'], {
    'domain': server[4],
    'port': 443,
    'path': server[6] or '/v2ray',
    'email': email or f"user_{user_id}@veilbot.com"
})
```

### 3. –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ –≤—ã–∑–æ–≤—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ë—ã–ª–æ:**
```python
format_key_message_with_protocol(config, protocol, tariff)
```

**–°—Ç–∞–ª–æ:**
```python
format_key_message_unified(config, protocol, tariff)
```

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. `handle_free_tariff_with_protocol`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ V2Ray –ø—Ä–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ email –≤ get_user_config
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω –≤—ã–∑–æ–≤ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. `create_new_key_flow_with_protocol`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ email –≤ get_user_config
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω –≤—ã–∑–æ–≤ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 3. `process_pending_paid_payments`
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω –≤—ã–∑–æ–≤ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤—ã–¥–∞—á–µ –∫–ª—é—á–µ–π

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç V2Ray –∫–ª—é—á–∞:
```
vless://8287ec93-b222-47cb-9aeb-bc73898a3c27@veil-bird.ru:443?encryption=none&security=reality&sni=www.microsoft.com&fp=chrome&pbk=eeA7CJSPNzlYKqXAsRfFNwtcpG2wXOtgDLPqaXBV13c&sid=2680beb40ea2fde0&spx=/&type=tcp&flow=#nvipetrenko@gmail.com
```

### ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```
üõ°Ô∏è –í–∞—à –∫–ª—é—á V2Ray VLESS (–∫–æ—Å–Ω–∏—Ç–µ—Å—å, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å):
`vless://...`

üì¶ –¢–∞—Ä–∏—Ñ: 1 –º–µ—Å—è—Ü
‚è± –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 30 –¥–Ω–µ–π

üîß –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ V2Ray –∫–ª–∏–µ–Ω—Ç:
   ‚Ä¢ App Store
   ‚Ä¢ Google Play
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´+¬ª
3. –í—ã–±–µ—Ä–∏—Ç–µ ¬´–ò–º–ø–æ—Ä—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞¬ª
4. –í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –≤—ã—à–µ
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç V2Ray –∫–ª—é—á–µ–π –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Reality –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

### 2. –ß–∏—Å—Ç–æ—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –£–±—Ä–∞–Ω–∞ –ª–∏—à–Ω—è—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π email –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 3. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–π Reality –ø—Ä–æ—Ç–æ–∫–æ–ª
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö V2Ray –∫–ª–∏–µ–Ω—Ç–æ–≤
- –õ—É—á—à–∞—è –æ–±—Ñ—É—Å–∫–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞

## –°—Ç–∞—Ç—É—Å
- ‚úÖ –í—Å–µ —Å—Ç–∞—Ä—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ email –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ –≤—ã–∑–æ–≤—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –°–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –§–æ—Ä–º–∞—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω –æ—Ç –ª–∏—à–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "–°–º–µ–Ω–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π. V2Ray –∫–ª—é—á–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç Reality –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –±–æ—Ç–∞. 