# Исправление доступа по IP адресам

## Проблема

Разные IP адреса показывали разное содержимое:
- **46.151.31.105** - открывается админка ✅
- **77.246.105.29** - показывал "Welcome to nginx" ❌
- **212.118.52.195** - сбой открытия страницы ❌

## Причина

1. **Для IP 77.246.105.29** не было отдельного server block в nginx, поэтому использовался default server (показывал "Welcome to nginx")
2. **Для IP 212.118.52.195** был server block, но порядок блоков был неправильным - блок для домена шел первым и перехватывал запросы
3. **Default server** был включен и перехватывал запросы к IP адресам

## Решение

### 1. Добавлен server block для IP 77.246.105.29
```nginx
server {
    listen 80;
    listen [::]:80;
    server_name 77.246.105.29;
    # ... проксирование на админку
}
```

### 2. Изменен порядок server blocks
Блоки для IP адресов теперь идут **ПЕРВЫМИ**, перед блоком для домена:
1. IP 46.151.31.105 (с default_server)
2. IP 77.246.105.29
3. IP 212.118.52.195
4. Домен veil-bot.ru (редирект на HTTPS)

### 3. Отключен default server
Удален `/etc/nginx/sites-enabled/default`, чтобы избежать конфликтов

### 4. Обновлена конфигурация
Конфигурация скопирована из `/root/veilbot/nginx/veil-bot.ru` в `/etc/nginx/sites-available/veil-bot.ru`

## Текущая конфигурация

### Порядок server blocks:
1. **IP 46.151.31.105** (default_server) - проксирование на админку
2. **IP 77.246.105.29** - проксирование на админку
3. **IP 212.118.52.195** - проксирование на админку
4. **Домен veil-bot.ru** - редирект на HTTPS
5. **HTTPS для домена** - проксирование на админку

### Все IP адреса теперь:
- Проксируют запросы на админку (http://127.0.0.1:8001)
- Имеют отдельные логи доступа
- Возвращают правильные ответы от админки

## Результаты проверки

### IP 46.151.31.105:
- ✅ HTTP 303 See Other → /login (правильный ответ админки)

### IP 77.246.105.29:
- ✅ HTTP 303 See Other → /login (правильный ответ админки)
- ✅ Логи создаются в `/var/log/nginx/77.246.105.29.access.log`

### IP 212.118.52.195:
- ✅ HTTP 303 See Other → /login (правильный ответ админки)
- ✅ Логи создаются в `/var/log/nginx/212.118.52.195.access.log`

## Статус: ✅ Исправлено

Все три IP адреса теперь правильно проксируют запросы на админку и возвращают одинаковые ответы.

## Примечания

- Все IP адреса делегированы к домену `veil-bot.ru` в DNS
- При доступе по домену происходит редирект на HTTPS
- При доступе по IP адресу открывается админка по HTTP (без редиректа)
