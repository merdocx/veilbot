# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ webhook –¥–ª—è Platega –∏ CryptoBot

## üîî Platega

- Endpoint: `https://veil-bot.ru/platega/webhook`
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: `X-Secret: <PLATEGA_SECRET>` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç –∑–∞–¥–∞–Ω)
- –¢—Ä–µ–±—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
  - `PLATEGA_MERCHANT_ID`
  - `PLATEGA_SECRET`
  - `PLATEGA_BASE_URL` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `https://app.platega.io`)
  - `PLATEGA_CALLBACK_URL` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –æ—Ç–ª–∏—á–µ–Ω –æ—Ç `/platega/webhook`)
- –í –∞–¥–º–∏–Ω–∫–µ –ª–æ–≥–∏: –ø—Ä–æ–≤–∞–π–¥–µ—Ä `platega`

> –ï—Å–ª–∏ Platega –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤–µ–±—Ö—É–∫–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è: —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ `pending` –≤ `paid`, –¥–∞–ª–µ–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–ª—é—á–∏/–ø–æ–¥–ø–∏—Å–∫–∏.

---

# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ webhook –¥–ª—è CryptoBot

## ‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≥–æ—Ç–æ–≤

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞ `veil-bot.ru` —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ñ–∞–π–ª–µ `veil-bot-ru-certificate.pem`.

## üì§ –ö–∞–∫ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ CryptoBot

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ –±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ **@CryptoBot** –≤ Telegram
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "Webhooks" –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/webhook`
3. –£–∫–∞–∂–∏—Ç–µ URL: `https://veil-bot.ru/cryptobot/webhook`
4. –ö–æ–≥–¥–∞ –±–æ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:
   - –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª" –∏–ª–∏ "Upload certificate"
   - –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª `veil-bot-ru-certificate.pem` –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/root/veilbot/`
   - –ò–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –±–æ—Ç—É –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ

–ï—Å–ª–∏ –±–æ—Ç –ø—Ä–æ—Å–∏—Ç –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `veil-bot-ru-certificate.pem`:
   ```bash
   cat veil-bot-ru-certificate.pem
   ```

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (–≤–∫–ª—é—á–∞—è —Å—Ç—Ä–æ–∫–∏ `-----BEGIN CERTIFICATE-----` –∏ `-----END CERTIFICATE-----`)

3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –≤ CryptoBot

## ‚ö†Ô∏è –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**Webhook –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω!** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –±–µ–∑ –Ω–µ–≥–æ:

- ‚úÖ **–° webhook**: –ö–ª—é—á –≤—ã–¥–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã (1-2 —Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ **–ë–µ–∑ webhook**: –ö–ª—é—á –≤—ã–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10-30 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)

–û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –Ω–∞–¥–µ–∂–Ω–æ. Webhook –ø—Ä–æ—Å—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å.

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã webhook

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:
   - –†–∞–∑–¥–µ–ª "Webhooks"
   - –§–∏–ª—å—Ç—Ä: provider="cryptobot"
   - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–ø–ª–∞—Ç—É:
   - –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂
   - –û–ø–ª–∞—Ç–∏—Ç–µ –µ–≥–æ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook –ø—Ä–∏—à–µ–ª (–≤ –ª–æ–≥–∞—Ö —Å—Ç–∞—Ç—É—Å "ok")

## üõ†Ô∏è –ï—Å–ª–∏ webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL:
   ```bash
   curl -I https://veil-bot.ru/cryptobot/webhook
   ```
   –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è —Å—Ç–∞—Ç—É—Å 405 (Method Not Allowed) - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è GET –∑–∞–ø—Ä–æ—Å–∞

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ nginx:
   ```bash
   tail -f /var/log/nginx/veil-bot.ru.access.log
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ endpoint –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:
   ```bash
   python3 check_cryptobot_setup.py
   ```

4. **–ü–æ–º–Ω–∏—Ç–µ**: –î–∞–∂–µ –µ—Å–ª–∏ webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–µ–π –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥!

## üìù –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑ webhook

–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å webhook, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —à–∞–≥. –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ polling:

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç ‚Üí CryptoBot —Å–æ–∑–¥–∞–µ—Ç –∏–Ω–≤–æ–π—Å
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
- –ö–æ–≥–¥–∞ –ø–ª–∞—Ç–µ–∂ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω ‚Üí –∫–ª—é—á –≤—ã–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ó–∞–¥–µ—Ä–∂–∫–∞: 10-30 —Å–µ–∫—É–Ω–¥ (–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤)

