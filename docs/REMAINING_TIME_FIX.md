# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏" –ø—Ä–∏ —Å–º–µ–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "–°–º–µ–Ω–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å –Ω–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ "–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏". –í–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å –ø–æ–ª–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∞—Ä–∏—Ñ–∞.

## –ü—Ä–∏—á–∏–Ω–∞
–í —Ñ—É–Ω–∫—Ü–∏–∏ `format_key_message_unified` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `tariff['duration_sec']` (–ø–æ–ª–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∞—Ä–∏—Ñ–∞), –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω–æ–µ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –∫–ª—é—á–∞.

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:
- –ö–ª—é—á –±—ã–ª —Å–æ–∑–¥–∞–Ω 15 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –Ω–∞ 30 –¥–Ω–µ–π
- –û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: 15 –¥–Ω–µ–π
- –ù–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å: 30 –¥–Ω–µ–π (–ø–æ–ª–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∞—Ä–∏—Ñ–∞)

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `format_key_message_unified`

**–ë—ã–ª–æ:**
```python
def format_key_message_unified(config: str, protocol: str, tariff: dict = None) -> str:
    # ...
    if tariff:
        message += (
            f"‚è± –û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: *{format_duration(tariff['duration_sec'])}*\n\n"
        )
```

**–°—Ç–∞–ª–æ:**
```python
def format_key_message_unified(config: str, protocol: str, tariff: dict = None, remaining_time: int = None) -> str:
    # ...
    # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Ä–µ–º–µ–Ω–∏
    if remaining_time is not None:
        # –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–æ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
        message += (
            f"‚è± –û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: *{format_duration(remaining_time)}*\n\n"
        )
    elif tariff:
        # –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∞—Ä–∏—Ñ–∞ (–¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π)
        message += (
            f"‚è± –û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: *{format_duration(tariff['duration_sec'])}*\n\n"
        )
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–∏

**–í `change_protocol_for_key` (—Å–º–µ–Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è):**

**Outline:**
```python
# –ë—ã–ª–æ:
await message.answer(format_key_message_unified(key["accessUrl"], new_protocol, tariff), ...)

# –°—Ç–∞–ª–æ:
await message.answer(format_key_message_unified(key["accessUrl"], new_protocol, tariff, remaining), ...)
```

**V2Ray:**
```python
# –ë—ã–ª–æ:
await message.answer(format_key_message_unified(config, new_protocol, tariff), ...)

# –°—Ç–∞–ª–æ:
await message.answer(format_key_message_unified(config, new_protocol, tariff, remaining), ...)
```

**–í `reissue_specific_key` (–ø–µ—Ä–µ–≤—ã–ø—É—Å–∫ –∫–ª—é—á–∞):**

**Outline:**
```python
# –ë—ã–ª–æ:
await message.answer(format_key_message(key["accessUrl"]), ...)

# –°—Ç–∞–ª–æ:
await message.answer(format_key_message_unified(key["accessUrl"], protocol, tariff, remaining), ...)
```

**V2Ray:**
```python
# –ë—ã–ª–æ:
await message.answer(format_key_message_unified(config, protocol, tariff), ...)

# –°—Ç–∞–ª–æ:
await message.answer(format_key_message_unified(config, protocol, tariff, remaining), ...)
```

## –õ–æ–≥–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
```python
# –°—á–∏—Ç–∞–µ–º –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
remaining = key_data['expiry_at'] - now
```

### 2. –ü–µ—Ä–µ–¥–∞—á–∞ –≤ —Ñ—É–Ω–∫—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```python
# –ü–µ—Ä–µ–¥–∞–µ–º –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
format_key_message_unified(config, protocol, tariff, remaining)
```

### 3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- **–ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω `remaining_time`** - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
- **–ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω** - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∞—Ä–∏—Ñ–∞ (–¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π)

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏:

**–ë—ã–ª–æ:**
```
üõ°Ô∏è –í–∞—à –∫–ª—é—á V2Ray VLESS (–∫–æ—Å–Ω–∏—Ç–µ—Å—å, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å):
vless://acf5b2c5-605a-44e9-9296-e593d876e6a6@veil-bird.ru:443?encryption=none&security=reality&sni=www.microsoft.com&fp=chrome&pbk=eeA7CJSPNzlYKqXAsRfFNwtcpG2wXOtgDLPqaXBV13c&sid=2680beb40ea2fde0&spx=/&type=tcp&flow=#nvipetrenko@gmail.com

‚è± –û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: 30 –¥–Ω–µ–π

üîß –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ V2Ray –∫–ª–∏–µ–Ω—Ç:
   ‚Ä¢ App Store
   ‚Ä¢ Google Play
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´+¬ª
3. –í—ã–±–µ—Ä–∏—Ç–µ ¬´–ò–º–ø–æ—Ä—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞¬ª
4. –í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –≤—ã—à–µ
```

**–°—Ç–∞–ª–æ:**
```
üõ°Ô∏è –í–∞—à –∫–ª—é—á V2Ray VLESS (–∫–æ—Å–Ω–∏—Ç–µ—Å—å, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å):
vless://acf5b2c5-605a-44e9-9296-e593d876e6a6@veil-bird.ru:443?encryption=none&security=reality&sni=www.microsoft.com&fp=chrome&pbk=eeA7CJSPNzlYKqXAsRfFNwtcpG2wXOtgDLPqaXBV13c&sid=2680beb40ea2fde0&spx=/&type=tcp&flow=#nvipetrenko@gmail.com

‚è± –û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: 15 –¥–Ω–µ–π

üîß –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ V2Ray –∫–ª–∏–µ–Ω—Ç:
   ‚Ä¢ App Store
   ‚Ä¢ Google Play
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´+¬ª
3. –í—ã–±–µ—Ä–∏—Ç–µ ¬´–ò–º–ø–æ—Ä—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞¬ª
4. –í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –≤—ã—à–µ
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –¢–æ—á–Ω–æ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ–µ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- ‚úÖ –ù–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—ã —Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é —Ç–∞—Ä–∏—Ñ–∞

### 2. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è Outline –∏ V2Ray
- ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π

### 3. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –î–ª—è –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π - –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
- ‚úÖ –§—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö

## –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:
- `change_protocol_for_key` - —Å–º–µ–Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Outline + V2Ray)
- `reissue_specific_key` - –ø–µ—Ä–µ–≤—ã–ø—É—Å–∫ –∫–ª—é—á–∞ (Outline + V2Ray)
- `format_key_message_unified` - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:
- –°–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏

## –°—Ç–∞—Ç—É—Å
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `format_key_message_unified` –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –í—Å–µ –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –°–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Å–º–µ–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–≤—ã–ø—É—Å–∫–µ –∫–ª—é—á–µ–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç–∞—Ä–∏—Ñ–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —Ç–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∏—Ö –∫–ª—é—á–∞. 