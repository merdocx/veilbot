# Требования к панели V2Ray: сброс трафика

## Проблема

После успешного ответа **POST** `/api/keys/{key_id}/traffic/reset` (200, `success: true`) запрос **GET** `/api/keys/{key_id}/traffic` должен возвращать обнулённую статистику: `total` / `total_bytes` = 0. Если GET продолжает возвращать старое значение, сброс на панели не реализован или не применяется к хранилищу статистики.

## Что должно делать API панели

1. **POST** `/api/keys/{key_id}/traffic/reset`  
   - Принять `key_id` в пути (числовой id или UUID ключа).  
   - Обнулить накопительную статистику трафика для этого ключа в том же хранилище, из которого отдаётся **GET** `/api/keys/{key_id}/traffic`.  
   - Вернуть 200 и JSON с полем `success: true` или сообщением вида `"Traffic reset successfully"`.

2. **GET** `/api/keys/{key_id}/traffic`  
   - После сброса должен возвращать `total` / `total_bytes` = 0 для этого ключа (без кэширования старых значений).

## Со стороны VeilBot

- При сбросе трафика подписки для каждого ключа: по UUID из БД запрашивается информация ключа (GET), получается числовой `key_id` панели, затем вызывается **POST** `/api/keys/{key_id}/traffic/reset`. Верификация после сброса не выполняется.
- В БД трафик всегда обнуляется; при «глючной» панели в течение 15 минут после сброса большие значения с API подавляются (см. логику в `monitor_subscription_traffic_limits`).
- При необходимости вернуть поведение для ненадёжной панели можно снова включить опциональную верификацию (например, флаг или конфиг) и при ненулевом ответе — повторную попытку по UUID или по numeric id.

## Где править панель

Код панели (api.veil-bear.ru или аналог) обычно находится в отдельном репозитории/проекте. Нужно в реализации эндпоинта `POST .../traffic/reset` обеспечить реальное обнуление счётчика трафика в БД/файле, откуда читается GET `.../traffic`.
