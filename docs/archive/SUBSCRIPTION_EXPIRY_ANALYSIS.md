# –ê–Ω–∞–ª–∏–∑ —É–∑–∫–∏—Ö –º–µ—Å—Ç –≤ —Å–∏—Å—Ç–µ–º–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-12-17  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ `create_subscriptions_for_users_without.py` ‚ö†Ô∏è –ê–†–•–ò–í–ò–†–û–í–ê–ù

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `scripts/archive/create_subscriptions_for_users_without.py:122`

**–°—Ç–∞—Ç—É—Å:** –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ –∞—Ä—Ö–∏–≤, —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–∂–µ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏.

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
expires_at = key_info.expiry_at  # –ë–µ—Ä–µ—Ç –¥–∞—Ç—É –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∫–ª—é—á–∞
```

**–†–∏—Å–∫:** –ï—Å–ª–∏ —É –∫–ª—é—á–∞ –±—ã–ª–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è (–∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ –≤ —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ), –ø–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è —Å —Ç–∞–∫–æ–π –∂–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∞—Ç–æ–π. –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –∏—Å–ø—Ä–∞–≤–∏–ª–∏.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é: –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ `expires_at` –Ω–µ —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –≤ –±—É–¥—É—â–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ –±–æ–ª–µ–µ 10 –ª–µ—Ç)
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: –µ—Å–ª–∏ `expires_at - created_at` –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∞—Ä–∏—Ñ–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `now + duration_sec` –≤–º–µ—Å—Ç–æ `expires_at`

### 2. –ü—Ä–æ–¥–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `key_management.py::extend_existing_key`

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `bot/services/key_management.py:217-226`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
if existing_key[1] <= now:
    new_expiry = now + duration
else:
    new_expiry = existing_key[1] + duration  # ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç expiry_at –∫–ª—é—á–∞!
```

**–†–∏—Å–∫:** –ï—Å–ª–∏ –∫–ª—é—á —Å–≤—è–∑–∞–Ω —Å –ø–æ–¥–ø–∏—Å–∫–æ–π, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ä–æ–∫ –ø–æ–¥–ø–∏—Å–∫–∏ (`current_expires`), –∞ –Ω–µ —Å—Ä–æ–∫ –∫–ª—é—á–∞ (`existing_key[1]`). –ö–æ–¥ –ø–æ–ª—É—á–∞–µ—Ç `current_expires` –∏–∑ –ø–æ–¥–ø–∏—Å–∫–∏ (—Å—Ç—Ä–æ–∫–∞ 204), –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞!

**–†–µ—à–µ–Ω–∏–µ:**
```python
if current_expires:
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ä–æ–∫ –ø–æ–¥–ø–∏—Å–∫–∏, –∞ –Ω–µ –∫–ª—é—á–∞
    if current_expires <= now:
        new_expiry = now + duration
    else:
        new_expiry = current_expires + duration
else:
    # Fallback –Ω–∞ —Å—Ä–æ–∫ –∫–ª—é—á–∞, –µ—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–µ—Ç
    if existing_key[1] <= now:
        new_expiry = now + duration
    else:
        new_expiry = existing_key[1] + duration
```

### 3. –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –¥–∞—Ç—ã

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `payments/services/subscription_purchase_service.py:545`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
new_expires_at = existing_expires_at + tariff['duration_sec']
```

**–†–∏—Å–∫:** –ï—Å–ª–∏ `existing_expires_at` —É–∂–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2100 –≥–æ–¥), –ø—Ä–æ–¥–ª–µ–Ω–∏–µ —É—Å—É–≥—É–±–∏—Ç –ø—Ä–æ–±–ª–µ–º—É. –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Ä–∞–∑—É–º–Ω–æ—Å—Ç—å –¥–∞—Ç—ã.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ–º:
  ```python
  MAX_REASONABLE_EXPIRY = now + (10 * 365 * 24 * 3600)  # 10 –ª–µ—Ç
  if existing_expires_at > MAX_REASONABLE_EXPIRY:
      logger.warning(f"Subscription {subscription_id} has unreasonable expiry date: {existing_expires_at}")
      # –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Ä–∞–∑—É–º–Ω—É—é –¥–∞—Ç—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å now + duration
      existing_expires_at = now + tariff['duration_sec']
  ```

### 4. –ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `bot/services/subscription_migration.py:221`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
duration_sec = expiry_at - now
```

**–†–∏—Å–∫:** –ï—Å–ª–∏ `expiry_at` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ –≤ —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ), –ø–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
  ```python
  MAX_DURATION = 365 * 24 * 3600  # 1 –≥–æ–¥
  if duration_sec > MAX_DURATION:
      logger.warning(f"Unreasonable duration for user {user_id}: {duration_sec}s")
      duration_sec = MAX_DURATION
  ```

## üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `payments/services/subscription_purchase_service.py:304`, `bot/services/subscription_service.py:556`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ `expires_at = now + duration_sec` –¥–∞–µ—Ç —Ä–∞–∑—É–º–Ω—É—é –¥–∞—Ç—É.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞:
```python
expires_at = now + tariff['duration_sec']
MAX_REASONABLE_EXPIRY = now + (10 * 365 * 24 * 3600)  # 10 –ª–µ—Ç
if expires_at > MAX_REASONABLE_EXPIRY:
    logger.error(f"Calculated expiry date is too far in future: {expires_at}")
    raise ValueError("Invalid expiry date calculated")
```

### 6. Race condition –ø—Ä–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏–∏

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `payments/services/subscription_purchase_service.py:545`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ–∂–¥—É –ø–æ–ª—É—á–µ–Ω–∏–µ–º `existing_expires_at` –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ø–æ–¥–ø–∏—Å–∫–∏ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –¥—Ä—É–≥–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–æ—Ç–µ—Ä–µ –æ–¥–Ω–æ–≥–æ –∏–∑ –ø—Ä–æ–¥–ª–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
```python
# –í–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ UPDATE –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
# —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
update_success = await self.subscription_repo.try_extend_subscription(
    subscription_id, 
    tariff['duration_sec'],
    expected_expires_at=existing_expires_at
)
```

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º

### 1. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–í `SubscriptionRepository.extend_subscription_async` –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É:
```python
async def extend_subscription_async(self, subscription_id: int, new_expires_at: int, tariff_id: Optional[int] = None):
    now = int(time.time())
    MAX_REASONABLE_EXPIRY = now + (10 * 365 * 24 * 3600)  # 10 –ª–µ—Ç
    
    if new_expires_at > MAX_REASONABLE_EXPIRY:
        logger.error(f"Attempt to set unreasonable expiry date for subscription {subscription_id}: {new_expires_at}")
        raise ValueError(f"Expiry date too far in future: {new_expires_at}")
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

–°–æ–∑–¥–∞—Ç—å —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ —Å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏:
```python
async def check_suspicious_subscriptions():
    now = int(time.time())
    MAX_REASONABLE = now + (2 * 365 * 24 * 3600)  # 2 –≥–æ–¥–∞
    
    # –ù–∞–π—Ç–∏ –ø–æ–¥–ø–∏—Å–∫–∏ —Å –¥–∞—Ç–∞–º–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è > 2 –ª–µ—Ç
    suspicious = await repo.get_subscriptions_with_expiry_after(MAX_REASONABLE)
    if suspicious:
        logger.warning(f"Found {len(suspicious)} suspicious subscriptions")
        # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç –∞–¥–º–∏–Ω—É
```

### 3. –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã

–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∞—Ç–æ–π
- –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∞—Ç–æ–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–ø—Ä–æ–¥–ª–µ–Ω–∏–∏

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

–î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥–∞—Ç–∞–º–∏:
```python
logger.info(
    f"[SUBSCRIPTION] Extending subscription {subscription_id}: "
    f"existing={existing_expires_at} ({datetime.fromtimestamp(existing_expires_at)}), "
    f"duration={tariff['duration_sec']}s, "
    f"new={new_expires_at} ({datetime.fromtimestamp(new_expires_at)})"
)
```

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `key_management.py::extend_existing_key` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ä–æ–∫ –ø–æ–¥–ø–∏—Å–∫–∏) - **–ò–°–ü–†–ê–í–õ–ï–ù–û**
   - ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ `subscription_purchase_service.py::_extend_subscription` - **–ò–°–ü–†–ê–í–õ–ï–ù–û**
   - ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `create_subscriptions_for_users_without.py` (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã) - **–ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ê–†–•–ò–í–ò–†–û–í–ê–ù–û**

2. **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
   - –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
   - –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## üîç –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ú–æ–∂–µ—Ç –ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å—Å—è?** –î–∞, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞:

1. –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏
2. –ü—Ä–æ–¥–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `key_management.py` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥–∞—Ç—É
3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ —Å –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
- `key_management.py::extend_existing_key` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞—Ç –≤ `subscription_purchase_service.py`
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

