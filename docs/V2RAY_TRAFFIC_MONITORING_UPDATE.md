# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ V2Ray - –ê–≤–≥—É—Å—Ç 2025

## üìã –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–û–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è V2Ray –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –Ω–æ–≤–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π API –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞—Ñ–∏–∫–∞. –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Å–∞—é—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –æ—Ç —Ç–æ—á–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ—Ä—Ç–æ–≤ –∫ –ø—Ä–æ—Å—Ç–æ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

### üîÑ –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- **–ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç:** `/api/traffic/simple` –≤–º–µ—Å—Ç–æ `/api/traffic/ports/exact`
- **–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞—Ñ–∏–∫–∞
- **–£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥
- **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è ESTAB, LAST-ACK, CLOSE-WAIT

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ `vpn_protocols.py`

### 1. **get_traffic_stats()** - –û–±–Ω–æ–≤–ª–µ–Ω
```python
# –°—Ç–∞—Ä—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
f"{self.api_url}/traffic/ports/exact"

# –ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
f"{self.api_url}/traffic/simple"
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ó–∞–º–µ–Ω–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–∞ `/api/traffic/simple`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞
- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è: `traffic_rate`, `interface_traffic`, `connection_details`
- –ò–∑–º–µ–Ω–µ–Ω –º–µ—Ç–æ–¥ —Å `port_monitor` –Ω–∞ `connection_based_estimation`

### 2. **get_key_traffic_stats()** - –û–±–Ω–æ–≤–ª–µ–Ω
```python
# –°—Ç–∞—Ä—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
f"{self.api_url}/keys/{key_id}/traffic/port/exact"

# –ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
f"{self.api_url}/keys/{key_id}/traffic/simple"
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ó–∞–º–µ–Ω–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–∞ `/api/keys/{key_id}/traffic/simple`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ (traffic –≤–º–µ—Å—Ç–æ port_traffic)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 3. **reset_key_traffic()** - –û–±–Ω–æ–≤–ª–µ–Ω
```python
# –°—Ç–∞—Ä—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
f"{self.api_url}/keys/{key_id}/traffic/port/reset"

# –ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
f"{self.api_url}/keys/{key_id}/traffic/simple/reset"
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ó–∞–º–µ–Ω–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–∞ `/api/keys/{key_id}/traffic/simple/reset`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Å–±—Ä–æ—Å–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—è `status` –≤ –æ—Ç–≤–µ—Ç–µ

## üìä –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ API

### –û–±—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ (`/api/traffic/simple`):
```json
{
  "status": "success",
  "data": {
    "ports": {
      "10001": {
        "port": 10001,
        "connections": 37,
        "total_bytes": 33323549,
        "rx_bytes": 16661774,
        "tx_bytes": 16661774,
        "total_formatted": "31.78 MB",
        "rx_formatted": "15.89 MB",
        "tx_formatted": "15.89 MB",
        "traffic_rate": 134128.74,
        "interface_traffic": {
          "rx_bytes": 5754086174,
          "tx_bytes": 5486110273,
          "total_bytes": 11240196447,
          "timestamp": 1754307939.2700043
        },
        "connection_details": [
          {
            "local": "[::ffff:146.103.100.14]:10001",
            "remote": "[::ffff:109.252.116.174]:1896",
            "state": "ESTAB"
          }
        ],
        "timestamp": 1754307939.2557962,
        "source": "simple_monitor",
        "method": "connection_based_estimation",
        "uuid": "e9828d67-08e2-4942-815d-61f41b3dacf7"
      }
    },
    "total_connections": 37,
    "total_bytes": 33323549,
    "timestamp": 1754307939.2557921
  },
  "timestamp": "2025-08-04T14:45:39.255792"
}
```

### –¢—Ä–∞—Ñ–∏–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ (`/api/keys/{key_id}/traffic/simple`):
```json
{
  "status": "success",
  "key": {
    "id": "11461131-0644-438d-9429-cb5e7f60fd80",
    "name": "nvipetrenko@gmail.con",
    "uuid": "e9828d67-08e2-4942-815d-61f41b3dacf7",
    "created_at": "2025-08-04T14:34:13.878594",
    "is_active": true,
    "port": 10001
  },
  "traffic": {
    "port": 10001,
    "connections": 37,
    "total_bytes": 33323549,
    "rx_bytes": 16661774,
    "tx_bytes": 16661774,
    "total_formatted": "31.78 MB",
    "rx_formatted": "15.89 MB",
    "tx_formatted": "15.89 MB",
    "traffic_rate": 134128.74,
    "interface_traffic": {
      "rx_bytes": 5754086174,
      "tx_bytes": 5486110273,
      "total_bytes": 11240196447,
      "timestamp": 1754307939.2700043
    },
    "connection_details": [
      {
        "local": "[::ffff:146.103.100.14]:10001",
        "remote": "[::ffff:109.252.116.174]:1896",
        "state": "ESTAB"
      }
    ],
    "timestamp": 1754307939.2557962,
    "source": "simple_monitor",
    "method": "connection_based_estimation",
    "uuid": "e9828d67-08e2-4942-815d-61f41b3dacf7"
  },
  "timestamp": "2025-08-04T14:45:39.255792"
}
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:
- –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ë–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥
- –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–ª–∏–∫ API
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### üìä –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è:
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (ESTAB, LAST-ACK, CLOSE-WAIT)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∞–¥—Ä–µ—Å–∞—Ö
- –°–∫–æ—Ä–æ—Å—Ç—å —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### üõ†Ô∏è –ü—Ä–æ—Å—Ç–æ—Ç–∞:
- –û–¥–∏–Ω –º–µ—Ç–æ–¥ –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞
- –õ–µ–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã:
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –Ω–æ–≤–æ–≥–æ API –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
- –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –±–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:
- **ESTAB** - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- **LAST-ACK** - –∑–∞–≤–µ—Ä—à–∞—é—â–∏–µ—Å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è  
- **CLOSE-WAIT** - –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è

### –ú–µ—Ç–æ–¥ –æ—Ü–µ–Ω–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞:
- **connection_based_estimation** - –æ—Ü–µ–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **interface_traffic** - –æ–±—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- **traffic_rate** - —Å–∫–æ—Ä–æ—Å—Ç—å —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ –±–∞–π—Ç–∞—Ö/—Å–µ–∫

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
1. **`/api/traffic/simple`** - –æ–±—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –≤—Å–µ—Ö –∫–ª—é—á–µ–π
2. **`/api/keys/{key_id}/traffic/simple`** - —Ç—Ä–∞—Ñ–∏–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
3. **`/api/keys/{key_id}/traffic/simple/reset`** - —Å–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –æ—Ç–≤–µ—Ç–µ:
- `traffic_rate` - —Å–∫–æ—Ä–æ—Å—Ç—å —Ç—Ä–∞—Ñ–∏–∫–∞
- `interface_traffic` - —Ç—Ä–∞—Ñ–∏–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- `connection_details` - –¥–µ—Ç–∞–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `source` - –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (simple_monitor)
- `method` - –º–µ—Ç–æ–¥ –æ—Ü–µ–Ω–∫–∏ (connection_based_estimation)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –∫ —Å—Ç–∞—Ä—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ:** ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã

**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è:** ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –Ω–æ–≤—ã–º API –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞—Ñ–∏–∫–∞

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 4 –∞–≤–≥—É—Å—Ç–∞ 2025 