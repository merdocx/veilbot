# üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API VPN —Å–µ—Ä–≤–µ—Ä–∞

> –í–Ω–∏–º–∞–Ω–∏–µ: –¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–π –≤–Ω–µ—à–Ω–∏–π API. –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (—Å–º. –Ω–∏–∂–µ ¬´–î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–µ–π—á–∞—Å¬ª). –ü—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –≤–∏–¥–∞ `/api/...` –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.

## üåê –ë–∞–∑–æ–≤—ã–π URL
```
https://your-domain.com/api
```

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–í—Å–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–∫—Ä–æ–º–µ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ `/` –∏ `/api/`) —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é API –∫–ª—é—á–∞.

**API –∫–ª—é—á –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è** –∏–∑ —Ñ–∞–π–ª–∞ `.env`

**–ó–∞–≥–æ–ª–æ–≤–æ–∫:** `X-API-Key: ***REMOVED***`

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl -k -H "X-API-Key: ***REMOVED***" "https://your-domain.com/api/keys"
```

### üîë –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞
API –∫–ª—é—á –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å –≤ `.env` –∫–∞–∫ `VPN_API_KEY` –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω–µ—à–Ω–µ–≥–æ API. –°–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç.

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** - –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —à–∏—Ñ—Ä—É—é—Ç—Å—è
- **API –∫–ª—é—á —Å–µ–∫—Ä–µ—Ç–Ω—ã–π** - –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º
- **–†–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è–π—Ç–µ –∫–ª—é—á** - –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìã –û–±—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
```http
Content-Type: application/json
Accept: application/json
```

## üìä –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤
- `200` - –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `401` - –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
- `404` - –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- `503` - –°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

---

## üîë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞
**POST** `/api/keys`

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π VPN –∫–ª—é—á —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º –∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç.

#### –ó–∞–ø—Ä–æ—Å:
```json
{
  "name": "–ú–æ–π VPN –∫–ª—é—á"
}
```

#### –û—Ç–≤–µ—Ç:
```json
{
  "id": "84570736-8bf5-47af-92d4-3a08f2693ef8",
  "name": "–ú–æ–π VPN –∫–ª—é—á",
  "uuid": "44ed718f-9f5d-4bd9-8585-e5a875cd3858",
  "created_at": "2025-08-02T15:22:39.822640",
  "is_active": true,
  "port": 10001
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X POST "https://your-domain.com/api/keys" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: ***REMOVED***" \
  -d '{"name": "–ú–æ–π VPN –∫–ª—é—á"}'
```

---

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–ª—é—á–µ–π
**GET** `/api/keys`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö VPN –∫–ª—é—á–µ–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö.

#### –û—Ç–≤–µ—Ç:
```json
[
  {
    "id": "84570736-8bf5-47af-92d4-3a08f2693ef8",
    "name": "–ú–æ–π VPN –∫–ª—é—á",
    "uuid": "44ed718f-9f5d-4bd9-8585-e5a875cd3858",
    "created_at": "2025-08-02T15:22:39.822640",
    "is_active": true,
    "port": 10001
  }
]
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X GET "https://your-domain.com/api/keys" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª—é—á–µ
**GET** `/api/keys/{key_id}`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º VPN –∫–ª—é—á–µ.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `key_id` - ID –∏–ª–∏ UUID –∫–ª—é—á–∞

#### –û—Ç–≤–µ—Ç:
```json
{
  "id": "84570736-8bf5-47af-92d4-3a08f2693ef8",
  "name": "–ú–æ–π VPN –∫–ª—é—á",
  "uuid": "44ed718f-9f5d-4bd9-8585-e5a875cd3858",
  "created_at": "2025-08-02T15:22:39.822640",
  "is_active": true,
  "port": 10001
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X GET "https://your-domain.com/api/keys/84570736-8bf5-47af-92d4-3a08f2693ef8" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 4. –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª—é—á–∞
**DELETE** `/api/keys/{key_id}`

–£–¥–∞–ª—è–µ—Ç VPN –∫–ª—é—á –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –ø–æ—Ä—Ç.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `key_id` - ID –∏–ª–∏ UUID –∫–ª—é—á–∞

#### –û—Ç–≤–µ—Ç:
```json
{
  "message": "Key deleted successfully"
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X DELETE "https://your-domain.com/api/keys/84570736-8bf5-47af-92d4-3a08f2693ef8" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 5. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞
**GET** `/api/keys/{key_id}/config`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VPN.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `key_id` - ID –∏–ª–∏ UUID –∫–ª—é—á–∞

#### –û—Ç–≤–µ—Ç:
```json
{
  "key": {
    "id": "84570736-8bf5-47af-92d4-3a08f2693ef8",
    "name": "–ú–æ–π VPN –∫–ª—é—á",
    "uuid": "44ed718f-9f5d-4bd9-8585-e5a875cd3858",
    "created_at": "2025-08-02T15:22:39.822640",
    "is_active": true,
    "port": 10001
  },
  "client_config": "vless://44ed718f-9f5d-4bd9-8585-e5a875cd3858@your-domain.com:10001?security=reality&sni=www.microsoft.com&fp=chrome&pbk=YOUR_PUBLIC_KEY&sid=YOUR_SESSION_ID&type=tcp#–ú–æ–π%20VPN%20–∫–ª—é—á"
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X GET "https://your-domain.com/api/keys/84570736-8bf5-47af-92d4-3a08f2693ef8/config" \
  -H "X-API-Key: ***REMOVED***"
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–π
**GET** `/api/traffic/simple`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª—é—á–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

#### –û—Ç–≤–µ—Ç:
```json
{
  "status": "success",
  "data": {
    "ports": {
      "10001": {
        "port": 10001,
        "connections": 37,
        "total_bytes": 33323549,
        "rx_bytes": 16661774,
        "tx_bytes": 16661774,
        "total_formatted": "31.78 MB",
        "rx_formatted": "15.89 MB",
        "tx_formatted": "15.89 MB",
        "traffic_rate": 134128.74,
        "interface_traffic": {
          "rx_bytes": 5754086174,
          "tx_bytes": 5486110273,
          "total_bytes": 11240196447,
          "timestamp": 1754307939.2700043
        },
        "connection_details": [
          {
            "local": "[::ffff:146.103.100.14]:10001",
            "remote": "[::ffff:109.252.116.174]:1896",
            "state": "ESTAB"
          }
        ],
        "timestamp": 1754307939.2557962,
        "source": "simple_monitor",
        "method": "connection_based_estimation",
        "uuid": "e9828d67-08e2-4942-815d-61f41b3dacf7"
      }
    },
    "total_connections": 37,
    "total_bytes": 33323549,
    "timestamp": 1754307939.2557921
  },
  "timestamp": "2025-08-04T14:45:39.255792"
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X GET "https://your-domain.com/api/traffic/simple" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
**GET** `/api/keys/{key_id}/traffic/simple`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `key_id` - ID –∏–ª–∏ UUID –∫–ª—é—á–∞

#### –û—Ç–≤–µ—Ç:
```json
{
  "status": "success",
  "key": {
    "id": "11461131-0644-438d-9429-cb5e7f60fd80",
    "name": "nvipetrenko@gmail.con",
    "uuid": "e9828d67-08e2-4942-815d-61f41b3dacf7",
    "created_at": "2025-08-04T14:34:13.878594",
    "is_active": true,
    "port": 10001
  },
  "traffic": {
    "port": 10001,
    "connections": 37,
    "total_bytes": 33323549,
    "rx_bytes": 16661774,
    "tx_bytes": 16661774,
    "total_formatted": "31.78 MB",
    "rx_formatted": "15.89 MB",
    "tx_formatted": "15.89 MB",
    "traffic_rate": 134128.74,
    "interface_traffic": {
      "rx_bytes": 5754086174,
      "tx_bytes": 5486110273,
      "total_bytes": 11240196447,
      "timestamp": 1754307939.2700043
    },
    "connection_details": [
      {
        "local": "[::ffff:146.103.100.14]:10001",
        "remote": "[::ffff:109.252.116.174]:1896",
        "state": "ESTAB"
      }
    ],
    "timestamp": 1754307939.2557962,
    "source": "simple_monitor",
    "method": "connection_based_estimation",
    "uuid": "e9828d67-08e2-4942-815d-61f41b3dacf7"
  },
  "timestamp": "2025-08-04T14:45:39.255792"
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X GET "https://your-domain.com/api/keys/11461131-0644-438d-9429-cb5e7f60fd80/traffic/simple" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 3. –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∫–ª—é—á–∞
**POST** `/api/keys/{key_id}/traffic/simple/reset`

–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `key_id` - ID –∏–ª–∏ UUID –∫–ª—é—á–∞

#### –û—Ç–≤–µ—Ç:
```json
{
  "status": "success",
  "message": "Traffic stats reset successfully",
  "key_id": "11461131-0644-438d-9429-cb5e7f60fd80",
  "timestamp": "2025-08-04T14:45:39.255792"
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X POST "https://your-domain.com/api/keys/11461131-0644-438d-9429-cb5e7f60fd80/traffic/simple/reset" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Å–≤–æ–¥–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
**GET** `/api/system/traffic/summary`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–æ–¥–∫—É —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –ø–æ –≤—Å–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º.

#### –û—Ç–≤–µ—Ç:
```json
{
  "summary": {
    "total_system_traffic": 10485760,
    "total_system_traffic_formatted": "10.0 MB",
    "active_ports": 2,
    "interface_summary": {
      "ens3": {
        "rx_bytes": 5242880,
        "tx_bytes": 5242880,
        "total_bytes": 10485760,
        "rx_formatted": "5.0 MB",
        "tx_formatted": "5.0 MB",
        "total_formatted": "10.0 MB"
      }
    },
    "timestamp": 1234567890
  },
  "timestamp": 1234567890
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X GET "https://your-domain.com/api/system/traffic/summary" \
  -H "X-API-Key: ***REMOVED***"
```

---

## üîå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞–º–∏

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Ä—Ç–æ–≤
**GET** `/api/system/ports`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è—Ö –ø–æ—Ä—Ç–æ–≤ –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.

#### –û—Ç–≤–µ—Ç:
```json
{
  "port_assignments": {
    "used_ports": {
      "10001": {
        "uuid": "44ed718f-9f5d-4bd9-8585-e5a875cd3858",
        "key_id": "84570736-8bf5-47af-92d4-3a08f2693ef8",
        "key_name": "–ú–æ–π VPN –∫–ª—é—á",
        "assigned_at": "2025-08-02T15:22:39.822640",
        "is_active": true
      }
    },
    "port_assignments": {
      "44ed718f-9f5d-4bd9-8585-e5a875cd3858": {
        "port": 10001,
        "key_id": "84570736-8bf5-47af-92d4-3a08f2693ef8",
        "key_name": "–ú–æ–π VPN –∫–ª—é—á",
        "assigned_at": "2025-08-02T15:22:39.822640"
      }
    },
    "created_at": "2025-08-02T15:22:39.822640",
    "last_updated": "2025-08-02T15:22:39.822640"
  },
  "used_ports": 1,
  "available_ports": 19,
  "max_ports": 20,
  "port_range": "10001-10020",
  "timestamp": 1234567890
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X GET "https://your-domain.com/api/system/ports" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 2. –°–±—Ä–æ—Å –≤—Å–µ—Ö –ø–æ—Ä—Ç–æ–≤
**POST** `/api/system/ports/reset`

–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Ä—Ç–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö).

#### –û—Ç–≤–µ—Ç:
```json
{
  "message": "All ports reset successfully",
  "status": "reset",
  "timestamp": 1234567890
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X POST "https://your-domain.com/api/system/ports/reset" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ—Ä—Ç–æ–≤
**GET** `/api/system/ports/status`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –ø–æ—Ä—Ç–æ–≤.

#### –û—Ç–≤–µ—Ç:
```json
{
  "validation": {
    "valid": true,
    "issues": [],
    "total_assignments": 1,
    "total_used_ports": 1
  },
  "timestamp": 1234567890
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X GET "https://your-domain.com/api/system/ports/status" \
  -H "X-API-Key: ***REMOVED***"
```

---

## ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π Xray

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Xray
**GET** `/api/system/xray/config-status`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Xray –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ inbounds.

#### –û—Ç–≤–µ—Ç:
```json
{
  "config_status": {
    "total_inbounds": 4,
    "vless_inbounds": 3,
    "api_inbounds": 1,
    "port_assignments": {
      "used_ports": {
        "10001": {
          "uuid": "44ed718f-9f5d-4bd9-8585-e5a875cd3858",
          "key_id": "84570736-8bf5-47af-92d4-3a08f2693ef8",
          "key_name": "–ú–æ–π VPN –∫–ª—é—á",
          "assigned_at": "2025-08-02T15:22:39.822640",
          "is_active": true
        }
      },
      "port_assignments": {
        "44ed718f-9f5d-4bd9-8585-e5a875cd3858": {
          "port": 10001,
          "key_id": "84570736-8bf5-47af-92d4-3a08f2693ef8",
          "key_name": "–ú–æ–π VPN –∫–ª—é—á",
          "assigned_at": "2025-08-02T15:22:39.822640"
        }
      }
    },
    "config_valid": true,
    "timestamp": "2025-08-02T15:22:39.822640"
  },
  "timestamp": 1234567890
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X GET "https://your-domain.com/api/system/xray/config-status" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Xray
**POST** `/api/system/xray/sync-config`

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Xray —Å –∫–ª—é—á–∞–º–∏ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å.

#### –û—Ç–≤–µ—Ç:
```json
{
  "message": "Xray configuration synchronized successfully",
  "status": "synced",
  "timestamp": 1234567890
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X POST "https://your-domain.com/api/system/xray/sync-config" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**GET** `/api/system/xray/validate-sync`

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Xray —Å –∫–ª—é—á–∞–º–∏.

#### –û—Ç–≤–µ—Ç:
```json
{
  "validation": {
    "synchronized": true,
    "key_uuids": ["44ed718f-9f5d-4bd9-8585-e5a875cd3858"],
    "config_uuids": ["44ed718f-9f5d-4bd9-8585-e5a875cd3858"],
    "missing_in_config": [],
    "extra_in_config": [],
    "total_keys": 1,
    "total_config_clients": 1
  },
  "timestamp": 1234567890
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X GET "https://your-domain.com/api/system/xray/validate-sync" \
  -H "X-API-Key: ***REMOVED***"
```

---

## üîß –°–∏—Å—Ç–µ–º–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Reality (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ)
**POST** `/api/system/verify-reality`

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Reality –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Xray.

#### –û—Ç–≤–µ—Ç:
```json
{
  "message": "Reality settings verified and updated successfully",
  "status": "verified",
  "timestamp": 1234567890
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X POST "https://your-domain.com/api/system/verify-reality" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ)
**POST** `/api/system/sync-config`

–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Xray —Å keys.json.

#### –û—Ç–≤–µ—Ç:
```json
{
  "message": "Configuration synchronized successfully",
  "status": "synced",
  "timestamp": 1234567890
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X POST "https://your-domain.com/api/system/sync-config" \
  -H "X-API-Key: ***REMOVED***"
```

---

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ)
**GET** `/api/system/config-status`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

#### –û—Ç–≤–µ—Ç:
```json
{
  "synchronized": true,
  "keys_json_count": 1,
  "config_json_count": 1,
  "keys_json_uuids": ["44ed718f-9f5d-4bd9-8585-e5a875cd3858"],
  "config_json_uuids": ["44ed718f-9f5d-4bd9-8585-e5a875cd3858"],
  "timestamp": 1234567890
}
```

#### –ü—Ä–∏–º–µ—Ä:
```bash
curl -X GET "https://your-domain.com/api/system/config-status" \
  -H "X-API-Key: ***REMOVED***"
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ)
```bash
# –°–æ–∑–¥–∞–µ–º –∫–ª—é—á
KEY_RESPONSE=$(curl -s -X POST "https://your-domain.com/api/keys" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: ***REMOVED***" \
  -d '{"name": "–ú–æ–π VPN –∫–ª—é—á"}')

# –ò–∑–≤–ª–µ–∫–∞–µ–º ID –∏ UUID
KEY_ID=$(echo $KEY_RESPONSE | python3 -c "import json, sys; print(json.load(sys.stdin)['id'])")
KEY_UUID=$(echo $KEY_RESPONSE | python3 -c "import json, sys; print(json.load(sys.stdin)['uuid'])")

# –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞
curl -s -X GET "https://your-domain.com/api/keys/$KEY_ID/config" \
  -H "X-API-Key: ***REMOVED***" | \
  python3 -c "import json, sys; print(json.load(sys.stdin)['client_config'])"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞ (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ)
```bash
# –ü–æ–ª—É—á–∞–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç—Ä–∞—Ñ–∏–∫–∞
curl -s -X GET "https://your-domain.com/api/traffic/simple" \
  -H "X-API-Key: ***REMOVED***"

# –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–∞—Ñ–∏–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
curl -s -X GET "https://your-domain.com/api/keys/$KEY_ID/traffic/simple" \
  -H "X-API-Key: ***REMOVED***"
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞–º–∏ (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ)
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ—Ä—Ç–æ–≤
curl -s -X GET "https://your-domain.com/api/system/ports" \
  -H "X-API-Key: ***REMOVED***"

# –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç—Ä–∞—Ñ–∏–∫–∞
curl -s -X POST "https://your-domain.com/api/keys/$KEY_ID/traffic/simple/reset" \
  -H "X-API-Key: ***REMOVED***"
```

---

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö
- üîç **–¢–æ—á–Ω–æ—Å—Ç—å** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥
- üìä **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- üõ†Ô∏è **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –æ–¥–∏–Ω –º–µ—Ç–æ–¥ –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:
- **ESTAB** - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- **LAST-ACK** - –∑–∞–≤–µ—Ä—à–∞—é—â–∏–µ—Å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è  
- **CLOSE-WAIT** - –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è

### –ú–µ—Ç–æ–¥ –æ—Ü–µ–Ω–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞:
- **connection_based_estimation** - –æ—Ü–µ–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **interface_traffic** - –æ–±—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- **traffic_rate** - —Å–∫–æ—Ä–æ—Å—Ç—å —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ –±–∞–π—Ç–∞—Ö/—Å–µ–∫

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å API –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

**–í–µ—Ä—Å–∏—è API:** 2.0.0  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 4 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è (–ø—É–±–ª–∏—á–Ω—ã–µ `/api` —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –Ω–µ –∞–∫—Ç–∏–≤–Ω—ã)

---

## –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–µ–π—á–∞—Å (–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)

–ë–∞–∑–æ–≤—ã–π URL –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –Ω–∞ —Ç–µ–∫—É—â–µ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ: `http(s)://<host>/`

- GET `/login` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞
- POST `/login` ‚Äî –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É (rate limit 5/–º–∏–Ω)
- GET `/logout` ‚Äî –≤—ã—Ö–æ–¥
- GET `/dashboard` ‚Äî –¥–∞—à–±–æ—Ä–¥
- GET `/tariffs` ‚Äî —Å–ø–∏—Å–æ–∫ —Ç–∞—Ä–∏—Ñ–æ–≤
- POST `/add_tariff` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ç–∞—Ä–∏—Ñ
- GET `/delete_tariff/{tariff_id}` ‚Äî —É–¥–∞–ª–∏—Ç—å —Ç–∞—Ä–∏—Ñ
- GET `/tariffs/edit/{tariff_id}` ‚Äî —Ñ–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞
- POST `/tariffs/edit/{tariff_id}` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ
- GET `/servers` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤
- POST `/add_server` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
- GET `/delete_server/{server_id}` ‚Äî —É–¥–∞–ª–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
- GET `/servers/edit/{server_id}` ‚Äî —Ñ–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
- POST `/servers/edit/{server_id}` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
- GET `/keys` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π
- GET `/keys/delete/{key_id}` ‚Äî —É–¥–∞–ª–∏—Ç—å –∫–ª—é—á
- GET `/cleanup` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—á–∏—Å—Ç–∫–∏
- POST `/cleanup` ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ—á–∏—Å—Ç–∫—É
- POST `/api/keys/{key_id}/expiry` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–ª—é—á–∞ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∞–¥–º–∏–Ω API)
- POST `/yookassa/webhook` ‚Äî –≤–µ–±—Ö—É–∫ YooKassa